(()=>{"use strict";const t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_disabled",activeButtonClass:"popup__save_valid",inputErrorClass:"popup__input_type_error",errorClass:"error"},e=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__edit-button"),i=document.forms.editForm,n=document.forms.addForm,o=i.elements.nameInput,r=i.elements.jobInput;class l{constructor(t,e,s){this._name=t.name,this._link=t.link,this._templateSelector=e,this._handleCardClick=s}generateCard=()=>(this._cardElement=document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0),this._like=this._cardElement.querySelector(".element__like-button"),this._title=this._cardElement.querySelector(".element__title"),this._mask=this._cardElement.querySelector(".element__mask"),this._trash=this._cardElement.querySelector(".element__trash"),this._fillCard(),this._setEventHandlers(),this._cardElement);_likeCard=()=>{this._like.classList.toggle("element__like-button_active")};_deleteCard=()=>{this._cardElement.remove()};_setEventHandlers=()=>{this._trash.addEventListener("click",(()=>this._deleteCard())),this._like.addEventListener("click",(()=>this._likeCard())),this._mask.addEventListener("click",(()=>this._handleCardClick(this._name,this._link)))};_fillCard=()=>{this._mask.src=this._link,this._mask.alt=this._name,this._title.textContent=this._name}}class a{constructor(t,e){this._form=e,this._config=t,this._buttonSave=this._form.querySelector(this._config.submitButtonSelector),this._inputList=Array.from(this._form.querySelectorAll(this._config.inputSelector))}enableValidation(){this._setEventListeners()}disableSubmitButton(){this._buttonSave.classList.remove(this._config.activeButtonClass),this._buttonSave.classList.add(this._config.inactiveButtonClass),this._buttonSave.disabled=!0}enableSubmitButton(){this._buttonSave.classList.add(this._config.activeButtonClass),this._buttonSave.classList.remove(this._config.inactiveButtonClass),this._buttonSave.disabled=!1}_showInputError(t){const e=this._form.querySelector(`.${t.id}-error`);e.classList.add(this._config.errorClass),e.textContent=t.validationMessage,t.classList.add(this._config.inputErrorClass)}_hideInputError(t){const e=this._form.querySelector(`.${t.id}-error`);e.classList.remove(this._config.errorClass),e.textContent="",t.classList.remove(this._config.inputErrorClass)}_checkInputValidity(t){t.validity.valid?this._hideInputError(t):this._showInputError(t)}_hasInvalidInput(){return this._inputList.some((t=>!t.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?this.disableSubmitButton():this.enableSubmitButton()}_setEventListeners(){this._toggleButtonState(this._inputList,this._buttonSave),this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._checkInputValidity(t),this._toggleButtonState(this._inputList,this._buttonSave)}))}))}}class c{constructor(t){this._popup=document.querySelector(t),this._button=this._popup.querySelector(".popup__close"),this._clickCloseButton=this._handleSubmit.bind(this),this._clickEscClose=this._handleEscClose.bind(this),this._clickClose=this._handleClose.bind(this),this._button.addEventListener("click",this._clickCloseButton)}open(){this.setEventListeners(),this._popup.classList.add("popup_opened")}close(){this._popup.classList.remove("popup_opened"),this.delEventListeners()}_handleSubmit(){this.close()}_handleEscClose(t){"Escape"===t.key&&this.close()}_handleClose(t){t.target.classList.contains("popup_opened")&&this.close()}setEventListeners(){document.addEventListener("keydown",this._clickEscClose),document.addEventListener("mouseup",this._clickClose)}delEventListeners(){document.removeEventListener("keydown",this._clickEscClose),document.removeEventListener("mouseup",this._clickClose)}}class u extends c{constructor(t,e){super(t),this._callbackSubmit=e,this._form=this._popup.querySelector(".popup__form"),this._inputs=[...this._form.querySelectorAll(".popup__input")]}_getInputValues(){const t={};return this._inputs.forEach((e=>{t[e.name]=e.value})),t}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(t=>{t.preventDefault(),this._callbackSubmit(this._getInputValues())}))}}function _(t){return new l(t,".element-template",(()=>v.open(t))).generateCard()}const p=new class{constructor({titleSelector:t,subtitleSelector:e}){this._title=document.querySelector(t),this._subtitle=document.querySelector(e)}getUserInfo(){return{title:this._title.textContent,subtitle:this._subtitle.textContent}}setUserInfo(t,e){this._title.textContent=t,this._subtitle.textContent=e}}({titleSelector:".profile__title",subtitleSelector:".profile__subtitle"}),d=new u(".popup_type_edit-profile",(function(t){p.setUserInfo(t.nameInput,t.jobInput),d.close()}));d.setEventListeners();const h=new class{constructor({renderer:t},e){this._renderer=t,this._container=document.querySelector(e)}addItem=t=>{this._container.prepend(t)};renderItems(t){t.forEach((t=>this._renderer(t)))}}({renderer:t=>h.addItem(_(t))},".elements"),m=new u(".popup_type_add-card",(t=>{h.addItem(_(t)),m.close()}));m.setEventListeners();const v=new class extends c{constructor(t){super(t),this._imagePopup=this._popup.querySelector(".popup__image"),this._imagePopupTitle=this._popup.querySelector(".popup__image-title")}open=t=>{this._imagePopupTitle.textContent=t.name,this._imagePopup.alt=t.name,this._imagePopup.src=t.link,super.open()}}(".popup_type_image");v.setEventListeners();const b=new a(t,i);b.enableValidation();const S=new a(t,n);S.enableValidation(),e.addEventListener("click",(()=>(S.disableSubmitButton(),void m.open()))),s.addEventListener("click",(()=>function(){const{title:t,subtitle:e}=p.getUserInfo();o.value=t,r.value=e,b.disableSubmitButton(),d.open()}())),h.renderItems([{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}].reverse())})();